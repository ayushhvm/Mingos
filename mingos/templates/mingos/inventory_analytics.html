{% extends "mingos/base.html" %} 
{% block title %}Inventory Analytics – Mingos{% endblock %} 
{% block content %}
<div class="page-header">
  <div>
    <div class="page-title">Inventory Analytics</div>
    <div class="page-subtitle">
      Monitor ingredient stock levels and inventory health.
    </div>
  </div>
  <div class="pill">
    {{ total_items }} ingredients • {{ low_stock_count }} low stock
  </div>
</div>

<div class="grid grid-4" style="margin-bottom: 18px">
  <div class="card">
    <div class="card-header">
      <div class="card-title">Total Ingredients</div>
    </div>
    <div class="card-value">{{ total_items }}</div>
    <div class="muted">Items in inventory</div>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-title">Low Stock Alerts</div>
      {% if low_stock_count > 0 %}
      <span class="chip chip-warning">{{ low_stock_count }} alert(s)</span>
      {% endif %}
    </div>
    <div class="card-value">{{ low_stock_count }}</div>
    <div class="muted">Below reorder level</div>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-title">Purchase Orders</div>
    </div>
    <div class="card-value">{{ recent_pos.count }}</div>
    <div class="muted">Recent POs tracked</div>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-title">Inventory Status</div>
      {% if low_stock_count == 0 %}
      <span class="chip chip-positive">Healthy</span>
      {% else %}
      <span class="chip chip-warning">Action Needed</span>
      {% endif %}
    </div>
    <div class="card-value">
      {% if low_stock_count == 0 %}✓{% else %}⚠{% endif %}
    </div>
    <div class="muted">Overall health</div>
  </div>
</div>

<div class="card" style="margin-bottom: 18px">
  <div class="card-header">
    <div class="card-title">Complete Inventory</div>
    <div class="muted" style="font-size: 0.85rem;">All ingredients with current stock levels</div>
  </div>
  <table>
    <thead>
      <tr>
        <th>Ingredient</th>
        <th>Current Stock</th>
        <th>Reorder Level</th>
        <th>Safety Stock</th>
        <th>Unit</th>
        <th>Status</th>
        <th>Stock %</th>
      </tr>
    </thead>
    <tbody>
      {% for ing in all_ingredients %}
      <tr {% if ing.current_stock_qty < ing.reorder_level %}style="background-color: rgba(239, 68, 68, 0.1);"{% endif %}>
        <td><strong>{{ ing.name }}</strong></td>
        <td>{{ ing.current_stock_qty|floatformat:1 }}</td>
        <td>{{ ing.reorder_level|floatformat:1 }}</td>
        <td>{{ ing.safety_stock_qty|floatformat:1 }}</td>
        <td class="muted">{{ ing.unit_of_measure }}</td>
        <td>
          {% if ing.current_stock_qty < ing.safety_stock_qty %}
            <span class="chip chip-negative">Critical</span>
          {% elif ing.current_stock_qty < ing.reorder_level %}
            <span class="chip chip-warning">Low Stock</span>
          {% elif ing.current_stock_qty >= ing.reorder_level %}
            <span class="chip chip-positive">Healthy</span>
          {% endif %}
        </td>
        <td>
          <div style="display: flex; align-items: center; gap: 8px;">
            <div style="flex: 1; background: rgba(55,65,81,0.5); height: 8px; border-radius: 4px; overflow: hidden;">
              <div style="
                height: 100%; 
                width: {{ ing.stock_percentage|floatformat:0 }}%; 
                background: {% if ing.current_stock_qty < ing.safety_stock_qty %}#ef4444{% elif ing.current_stock_qty < ing.reorder_level %}#f59e0b{% else %}#22c55e{% endif %};
                border-radius: 4px;
              "></div>
            </div>
            <span class="muted" style="font-size: 0.85rem; min-width: 40px;">{{ ing.stock_percentage|floatformat:0 }}%</span>
          </div>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="7" class="muted">No ingredients in inventory.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
